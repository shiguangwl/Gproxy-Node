<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gproxy-Node ç®¡ç†ç•Œé¢</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; padding: 20px; 
            background: #f5f5f5; color: #333;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; padding: 30px; border-radius: 10px;
            margin-bottom: 20px; text-align: center;
        }
        .card { 
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px;
        }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .stat-item { padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .stat-value { font-size: 2em; font-weight: bold; color: #3498db; }
        .btn { 
            background: #3498db; color: white; padding: 10px 20px;
            border: none; border-radius: 5px; cursor: pointer;
            margin: 5px; transition: background 0.3s;
        }
        .btn:hover { background: #2980b9; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .feature-list { list-style: none; padding: 0; }
        .feature-list li { padding: 10px; background: #e8f5e8; margin: 5px 0; border-radius: 5px; }
        .feature-list li:before { content: "âœ… "; }
        pre { background: #2c3e50; color: #ecf0f1; padding: 15px; border-radius: 8px; overflow-x: auto; }
        .loading { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ Gproxy-Node v2.0.0</h1>
            <p>å¢å¼ºç‰ˆå…¨å±€ä»£ç†æœåŠ¡å™¨ç®¡ç†ç•Œé¢</p>
        </div>
        
        <div class="card">
            <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
            <div class="stats-grid" id="statsGrid">
                <div class="loading">åŠ è½½ä¸­...</div>
            </div>
            <button class="btn" onclick="refreshStats()">åˆ·æ–°çŠ¶æ€</button>
        </div>
        
        <div class="card">
            <h2>ğŸ”§ åŠŸèƒ½ç‰¹æ€§</h2>
            <ul class="feature-list">
                <li>URL Base64ç¼–ç ä¼ è¾“ - è§£å†³å¤æ‚URLè§£æé—®é¢˜</li>
                <li>å¤§æ–‡ä»¶æµå¼å¤„ç† - é¿å…å†…å­˜æº¢å‡º</li>
                <li>æ™ºèƒ½è¿æ¥æ± ç®¡ç† - æå‡æ€§èƒ½å’Œç¨³å®šæ€§</li>
                <li>æŒ‡æ•°é€€é¿é‡è¯•ç­–ç•¥ - å¢å¼ºå¯é æ€§</li>
                <li>å¢å¼ºå†…å®¹å¤„ç† - æ”¯æŒCSS/JS/HTMLæ™ºèƒ½æ›¿æ¢</li>
                <li>åª’ä½“è¯·æ±‚ä¼˜åŒ– - ä¸“é—¨é’ˆå¯¹è§†é¢‘/éŸ³é¢‘ä¼˜åŒ–</li>
                <li>é”™è¯¯æ¢å¤æœºåˆ¶ - è‡ªåŠ¨å¤„ç†å„ç±»å¼‚å¸¸</li>
                <li>æ€§èƒ½ç›‘æ§ - å®æ—¶ç»Ÿè®¡å’Œåˆ†æ</li>
            </ul>
        </div>
        
        <div class="card">
            <h2>âš™ï¸ é…ç½®ç®¡ç†</h2>
            <button class="btn" onclick="reloadConfig()">é‡æ–°åŠ è½½é…ç½®</button>
            <button class="btn" onclick="showConfig()">æŸ¥çœ‹é…ç½®</button>
            <pre id="configDisplay" style="display: none;"></pre>
        </div>
        
        <div class="card">
            <h2>ğŸŒ è¿æ¥ç®¡ç†</h2>
            <button class="btn" onclick="showConnections()">æŸ¥çœ‹è¿æ¥çŠ¶æ€</button>
            <button class="btn btn-danger" onclick="resetConnections()">é‡ç½®è¿æ¥ç»Ÿè®¡</button>
            <pre id="connectionDisplay" style="display: none;"></pre>
        </div>
        
        <div class="card">
            <h2>ğŸ“ ä½¿ç”¨è¯´æ˜</h2>
            <h3>åŸºç¡€ä»£ç†</h3>
            <p>ç›´æ¥è®¿é—®ï¼š<code>http://localhost:8000/</code></p>
            
            <h3>å…¨å±€ä»£ç†ï¼ˆBase64ç¼–ç ï¼‰</h3>
            <p>æ ¼å¼ï¼š<code>http://localhost:8000/${configLoader.getConfig().globalProxyPath}/[Base64ç¼–ç çš„URL]</code></p>
            <p>å‰ç«¯ä¼šè‡ªåŠ¨å¤„ç†ç¼–ç ï¼Œæ— éœ€æ‰‹åŠ¨æ“ä½œ</p>
            
            <h3>APIç«¯ç‚¹</h3>
            <ul>
                <li><code>/health</code> - å¥åº·æ£€æŸ¥</li>
                <li><code>/admin/status</code> - è¯¦ç»†çŠ¶æ€</li>
                <li><code>/admin/config</code> - é…ç½®ä¿¡æ¯</li>
                <li><code>/admin/connections</code> - è¿æ¥ä¿¡æ¯</li>
            </ul>
        </div>
    </div>
    
    <script>
        // æ³¨æ„ï¼šè¿™é‡ŒåŸå…ˆçš„ ${configLoader.getConfig().globalProxyPath} æ— æ³•åœ¨é™æ€HTMLä¸­ç›´æ¥è·å–ã€‚
        // æ‚¨å¯èƒ½éœ€è¦é€šè¿‡APIä»åç«¯è·å–è¿™ä¸ªå€¼ï¼Œæˆ–è€…åœ¨åç«¯æ¸²æŸ“HTMLæ—¶æ³¨å…¥ã€‚
        // ä¸ºç®€å•èµ·è§ï¼Œæ­¤å¤„æš‚æ—¶ç•™ç©ºæˆ–ä½¿ç”¨å ä½ç¬¦ã€‚
        // ä¾‹å¦‚: const globalProxyPath = await fetch('/api/global-proxy-path').then(res => res.text());
        // ç„¶ååœ¨ä¸‹é¢çš„å­—ç¬¦ä¸²æ¨¡æ¿ä¸­ä½¿ç”¨ globalProxyPath
        const GLOBAL_PROXY_PATH_PLACEHOLDER = "proxy"; // å‡è®¾é»˜è®¤å€¼æˆ–ä»APIè·å–

        async function refreshStats() {
            try {
                const response = await fetch('/admin/status');
                const data = await response.json();
                
                const statsHtml = \`
                    <div class="stat-item">
                        <div class="stat-value">\${data.system.uptime.toFixed(0)}s</div>
                        <div>è¿è¡Œæ—¶é—´</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">\${data.connectionManager.successRate.toFixed(2)}%</div>
                        <div>æˆåŠŸç‡</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">\${data.connectionManager.averageResponseTime.toFixed(0)}ms</div>
                        <div>å¹³å‡å“åº”æ—¶é—´</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">\${data.connectionManager.stats.totalRequests}</div>
                        <div>æ€»è¯·æ±‚æ•°</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">\${(data.system.memory.heapUsed / 1024 / 1024).toFixed(1)}MB</div>
                        <div>å†…å­˜ä½¿ç”¨</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">\${data.configuration.replaceRulesCount}</div>
                        <div>æ›¿æ¢è§„åˆ™æ•°</div>
                    </div>
                \`;
                
                document.getElementById('statsGrid').innerHTML = statsHtml;
            } catch (error) {
                alert('è·å–çŠ¶æ€å¤±è´¥: ' + error.message);
            }
        }
        
        async function reloadConfig() {
            try {
                const response = await fetch('/admin/config/reload', { method: 'POST' });
                const data = await response.json();
                alert(data.message || 'é…ç½®é‡æ–°åŠ è½½æˆåŠŸ');
                refreshStats();
            } catch (error) {
                alert('é‡æ–°åŠ è½½é…ç½®å¤±è´¥: ' + error.message);
            }
        }
        
        async function showConfig() {
            try {
                const response = await fetch('/admin/config');
                const data = await response.json();
                document.getElementById('configDisplay').style.display = 'block';
                document.getElementById('configDisplay').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                alert('è·å–é…ç½®å¤±è´¥: ' + error.message);
            }
        }
        
        async function showConnections() {
            try {
                const response = await fetch('/admin/connections');
                const data = await response.json();
                document.getElementById('connectionDisplay').style.display = 'block';
                document.getElementById('connectionDisplay').textContent = JSON.stringify(data, null, 2);
            } catch (error) {
                alert('è·å–è¿æ¥ä¿¡æ¯å¤±è´¥: ' + error.message);
            }
        }
        
        async function resetConnections() {
            if (confirm('ç¡®å®šè¦é‡ç½®è¿æ¥ç»Ÿè®¡å—ï¼Ÿ')) {
                try {
                    const response = await fetch('/admin/connections/reset', { method: 'POST' });
                    const data = await response.json();
                    alert(data.message || 'è¿æ¥ç»Ÿè®¡å·²é‡ç½®');
                    refreshStats();
                } catch (error) {
                    alert('é‡ç½®è¿æ¥ç»Ÿè®¡å¤±è´¥: ' + error.message);
                }
            }
        }
        
        // åˆå§‹åŠ è½½
        refreshStats();
        
        // è‡ªåŠ¨åˆ·æ–°
        setInterval(refreshStats, 30000);

        // æ›´æ–°å…¨å±€ä»£ç†è·¯å¾„æ˜¾ç¤º
        async function updateGlobalProxyPathPlaceholder() {
            try {
                // é€šå¸¸ï¼Œå®¢æˆ·ç«¯JSæ— æ³•ç›´æ¥è®¿é—®æœåŠ¡å™¨ç«¯çš„ configLoader.getConfig()
                // æ‚¨éœ€è¦åˆ›å»ºä¸€ä¸ªAPIç«¯ç‚¹æ¥æš´éœ²è¿™ä¸ªé…ç½®ï¼Œæˆ–è€…åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“æ—¶æ³¨å…¥å®ƒã€‚
                // è¿™é‡Œæˆ‘ä»¬å‡è®¾æœ‰ä¸€ä¸ªAPI /admin/config è¿”å›åŒ…å« globalProxyPath çš„é…ç½®
                const response = await fetch('/admin/config');
                if (!response.ok) {
                    throw new Error(\`Failed to fetch config: \${response.status}\`);
                }
                const config = await response.json();
                if (config.globalProxyPath) {
                    const usageElement = document.querySelector('.card h3 + p + p'); // å®šä½åˆ°æ˜¾ç¤ºå…¨å±€ä»£ç†æ ¼å¼çš„pæ ‡ç­¾
                    if (usageElement) {
                        usageElement.innerHTML = \`æ ¼å¼ï¼š<code>http://localhost:8000/\${config.globalProxyPath}/[Base64ç¼–ç çš„URL]</code>\`;
                    }
                }
            } catch (error) {
                console.error('æ›´æ–°å…¨å±€ä»£ç†è·¯å¾„å¤±è´¥:', error);
                // å¯ä»¥é€‰æ‹©åœ¨è¿™é‡Œç»™ç”¨æˆ·ä¸€ä¸ªæç¤º
            }
        }
        updateGlobalProxyPathPlaceholder();
    </script>
</body>
</html> 